<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Analyst Page</title>
    <link rel="stylesheet" href="/styles/main.css">
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@2.11.6/dist/umd/popper.min.js" integrity="sha384-sN5FbqA8p7XM6jQ9EmTTOzqMF6I4j3/A6MLG1XM5Xub3iBXYdaBVsYyo9v8SpaT6" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="alert.js"></script>
    <style>
        /* Custom CSS for the table */
        #resultsTable th, #resultsTable td {
            text-align: center;
            max-width: 150px;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="index.html" class="nav-link">Home</a>
        <a href="server-view.html" class="admin">Admin</a>
    </div>
    <div class="container">
        <h1 class="my-4">Survey Results</h1>
        <div class="table-responsive">
            <table id="resultsTable" class="table table-striped table-hover w-100">
                <thead class="sticky-top">
                    <!-- Table headers -->
                    <tr>
                        <th>Overall Impression</th>
                        <th>Easy Navigation</th>
                        <th>Helpful Features</th>
                        <th>Overall Visual Appeal</th>
                        <th>Comments</th>
                        <th>Date Submitted</th> <!-- New column header -->
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    

    <!-- Include jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-beta1/js/bootstrap.bundle.min.js"></script>

    <script>
        // Fetch the survey data when the page loads
        window.onload = function() {
            fetch('http://localhost:5501/get_survey_data')
                .then(response => response.json())
                .then(data => {
                    // Get the table body
                    var tbody = document.getElementById('resultsTable').getElementsByTagName('tbody')[0];
    
                    // Add a data row to the table for each object in the data array
                    for (var i = 0; i < data.length; i++) {
                        var dataRow = tbody.insertRow();
                        var keys = ['textQuestion', 'listQuestion', 'checkboxQuestion', 'visual_appeal', 'comments', 'timestamp']; // Include 'timestamp'
                        
                        for (var j = 0; j < keys.length; j++) {
                            var key = keys[j];
                            var td = dataRow.insertCell();
                            var value = data[i][key];
                            
                            // Handle array and empty values
                            if (Array.isArray(value)) {
                                value = value.join(', ');
                            } else if (value === undefined || value === '') {
                                value = 'N/A';
                            }

                            // Convert timestamp to date format
                            if (key === 'timestamp') {
                                var date = new Date(value);
                                value = date.toLocaleDateString('en-US');
                            }
                            
                            td.appendChild(document.createTextNode(value));
                        }
                    }
                })
                .catch(error => console.error('Error:', error));
        };
    </script>        
</body>
</html>
